<!DOCTYPE html>
<!--
    Hi-Tech Internet Hotspot Portal - Admin Panel
    Copyright (c) 2025 Mahmoud. All rights reserved.
    
    Developed by: Mahmoud
    Website: Hi-Tech Internet Services
    Description: Administrative panel for maintenance notifications
    
    This software is proprietary and confidential.
    Unauthorized copying, distribution, or modification is strictly prohibited.
-->
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… - Ù‡Ø§ÙŠ ØªÙƒ">
    <meta name="theme-color" content="#DC2626">
    <meta name="robots" content="noindex, nofollow">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 30%, #22C55E 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .admin-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            min-height: 500px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .admin-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #22C55E, #16A34A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-subtitle {
            font-size: 16px;
            opacity: 0.8;
        }

        .notification-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #F9FAFB;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: #FFFFFF;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #22C55E;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3), 0 4px 12px rgba(34, 197, 94, 0.15);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .notification-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .notification-type {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .notification-type:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.15);
        }

        .notification-type.selected {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22C55E;
        }

        .notification-type-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .notification-type-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-type-desc {
            font-size: 12px;
            opacity: 0.7;
        }

        .send-button {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(34, 197, 94, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .preview-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #4ADE80;
        }

        .notification-preview {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            border-right: 4px solid #22C55E;
        }

        .preview-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .preview-icon {
            font-size: 20px;
        }

        .preview-app-name {
            font-size: 12px;
            opacity: 0.7;
        }

        .preview-notification-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .preview-notification-body {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .status-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
        }

        .status-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #4ADE80;
        }

        .status-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .status-label {
            font-size: 14px;
        }

        .status-value {
            font-weight: 600;
            color: #22C55E;
        }

        .test-button {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 16px;
        }

        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(34, 197, 94, 0.3);
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 20px;
                margin: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .notification-types {
                grid-template-columns: 1fr;
            }
        }

        /* Enhanced Notification System */
        #message-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            min-width: 300px;
        }

        .success-message,
        .error-message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
            backdrop-filter: blur(20px);
            border: 2px solid transparent;
            position: relative;
            transform: translateX(100%);
            animation: slideInRight 0.4s ease-out forwards;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .success-message {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.9));
            color: #FFFFFF;
            border-color: rgba(34, 197, 94, 0.8);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            font-weight: 700;
        }

        .error-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.9));
            color: #FFFFFF;
            border-color: rgba(239, 68, 68, 0.8);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            font-weight: 700;
        }

        .message-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .message-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .message-text {
            flex: 1;
        }

        .message-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 0 0 12px 12px;
            animation: progressBar 10s linear forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        /* Mobile responsive notifications */
        @media (max-width: 768px) {
            #message-area {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
            }
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .user-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22C55E, #16A34A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #FFFFFF;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .user-ip {
            font-size: 12px;
            color: #D1D5DB;
        }

        .user-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
        }

        .user-time {
            font-size: 12px;
            color: #22C55E;
            font-weight: 600;
        }

        .user-data {
            font-size: 11px;
            color: #9CA3AF;
        }

        /* Admin Login Styles */
        .admin-login {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 30%, #22C55E 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #22C55E, #16A34A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 32px;
            color: #E5E7EB;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .login-input:focus {
            outline: none;
            border-color: #22C55E;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .login-button {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .login-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(34, 197, 94, 0.4);
        }

        .login-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 16px;
        }

        .security-notice {
            margin-top: 24px;
            padding: 16px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            font-size: 12px;
            color: #4ADE80;
        }

        .hidden {
            display: none !important;
        }

        /* Initially hide admin panel, show login */
        .admin-container {
            display: none;
        }

        /* Ensure login is visible by default */
        .admin-login {
            display: flex !important;
        }

        /* When admin panel is active */
        .admin-container.active {
            display: block !important;
        }
    </style>
</head>
<body>
    <!-- Admin Login Screen -->
    <div class="admin-login" id="adminLogin">
        <div class="login-card">
            <h1 class="login-title">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
            <p class="login-subtitle">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¢Ù…Ù†Ø©</p>
            
            <form class="login-form" onsubmit="adminLogin(event)">
                <input 
                    type="text" 
                    id="adminUsername" 
                    class="login-input" 
                    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ" 
                    required 
                    autocomplete="username"
                >
                <input 
                    type="password" 
                    id="adminPassword" 
                    class="login-input" 
                    placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©" 
                    required 
                    autocomplete="current-password"
                >
                <button type="submit" class="login-button" id="loginButton">
                    ğŸ”“ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                </button>
            </form>
            
            <div id="loginError" class="login-error hidden">
                Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
            </div>
            
            <div class="security-notice">
                ğŸ”’ Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ù…ØªÙ‚Ø¯Ù…: Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆÙ…Ø³Ø¬Ù„Ø©<br>
                <strong>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©:</strong><br>
                ğŸ“§ admin / hitech2025<br>
                ğŸ‘¤ Ù…Ø­Ù…ÙˆØ¯ / mahmoud123<br>
                ğŸ’¼ administrator / admin@hitech<br>
                ğŸ¢ hitech / admin2025
            </div>
        </div>
    </div>

    <!-- Main Admin Panel (Hidden until login) -->
    <div class="admin-container" id="adminPanel">
        <div class="admin-header">
            <h1 class="admin-title">ğŸ”§ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
            <p class="admin-subtitle">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†</p>
            
            <!-- Admin Session & MikroTik Status -->
            <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 14px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="color: #4ADE80;">ğŸ‘¤ Ù…Ø¯ÙŠØ±:</span> 
                    <span id="adminUser" style="color: #E5E7EB; font-weight: 600;">--</span>
                    <span style="color: #4ADE80; margin-right: 20px;">ğŸ”— Ø®Ø§Ø¯Ù… MikroTik:</span> 
                    <span id="mikrotikStatus" style="color: #E5E7EB;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
                </div>
                <div>
                    <button onclick="configureMikroTik()" style="margin-left: 8px; padding: 6px 12px; background: rgba(34,197,94,0.2); border: 1px solid #22C55E; border-radius: 6px; color: #22C55E; cursor: pointer; font-size: 12px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª MikroTik</button>
                    <button onclick="adminLogout()" style="padding: 6px 12px; background: rgba(239,68,68,0.2); border: 1px solid #EF4444; border-radius: 6px; color: #EF4444; cursor: pointer; font-size: 12px;">ğŸšª Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
                </div>
            </div>
        </div>

        <div id="message-area"></div>

        <div class="notification-form">
            <h3 style="margin-bottom: 20px; color: #E5E7EB;">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</h3>
            
            <div class="notification-types">
                <div class="notification-type" data-type="maintenance_alert">
                    <div class="notification-type-icon">ğŸ”§</div>
                    <div class="notification-type-title">ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    <div class="notification-type-desc">Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø¯Ø¡ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                </div>
                
                <div class="notification-type" data-type="maintenance_completed">
                    <div class="notification-type-icon">âœ…</div>
                    <div class="notification-type-title">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
                    <div class="notification-type-desc">Ø¥Ø¹Ù„Ø§Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
                </div>
                
                <div class="notification-type" data-type="service_announcement">
                    <div class="notification-type-icon">ğŸ“¢</div>
                    <div class="notification-type-title">Ø¥Ø¹Ù„Ø§Ù† Ù…Ù‡Ù…</div>
                    <div class="notification-type-desc">Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù… Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="notificationTitle" class="form-input" placeholder="Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹">
            </div>

            <div class="form-group">
                <label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</label>
                <textarea id="notificationMessage" class="form-textarea" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§..." required></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                    <input type="number" id="duration" class="form-input" value="5" min="1" max="60">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <select id="priority" class="form-select">
                        <option value="normal">Ø¹Ø§Ø¯ÙŠØ©</option>
                        <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                        <option value="urgent">Ø¹Ø§Ø¬Ù„Ø©</option>
                    </select>
                </div>
            </div>

            <button class="send-button" onclick="sendNotification()">
                ğŸ“¡ Ø¨Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø²ÙˆØ§Ø±
            </button>
        </div>

        <div class="preview-section">
            <h3 class="preview-title">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</h3>
            <div class="notification-preview">
                <div class="preview-header">
                    <span class="preview-icon">ğŸ”§</span>
                    <span class="preview-app-name">Ù‡Ø§ÙŠ ØªÙƒ Ù„Ù„Ø¥Ù†ØªØ±Ù†Øª</span>
                </div>
                <div class="preview-notification-title" id="previewTitle">ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                <div class="preview-notification-body" id="previewBody">Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡Ø§ Ù‡Ù†Ø§</div>
            </div>
        </div>

        <div class="status-section">
            <h3 class="status-title">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            
            <div class="status-item">
                <span class="status-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</span>
                <span class="status-value" id="connectedUsers">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</span>
                <span class="status-value" id="totalUsersToday">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                <span class="status-value" id="dataUsage">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</span>
                <span class="status-value" id="notificationsSent">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±</span>
                <span class="status-value" id="lastNotification">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                <span class="status-value" id="activeNotifications">--</span>
            </div>
            
            <div class="status-item">
                <span class="status-label">Ø³Ø±Ø¹Ø© Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</span>
                <span class="status-value" id="avgSpeed">--</span>
            </div>

            <button class="test-button" onclick="sendTestNotification()">
                ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
            </button>
            
            <button class="test-button" onclick="refreshSystemData()" style="margin-right: 10px;">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>
        
        <!-- Users List Section -->
        <div class="status-section" style="margin-top: 24px;">
            <h3 class="status-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† (Ù…Ø¨Ø§Ø´Ø±)</h3>
            <div id="usersList">
                <div style="text-align: center; opacity: 0.7; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>
            </div>
        </div>
    </div>

    <script>
        // Admin Authentication Configuration
        const ADMIN_CREDENTIALS = {
            'admin': 'hitech2025',
            'Ù…Ø­Ù…ÙˆØ¯': 'mahmoud123',
            'administrator': 'admin@hitech',
            'hitech': 'admin2025'
        };

        // Session management
        let currentAdminUser = null;
        let selectedNotificationType = 'maintenance_alert';
        let sessionTimeout = null;
        const SESSION_DURATION = 30 * 60 * 1000; // 30 minutes

        // Admin login function with better error handling
        async function adminLogin(event) {
            event.preventDefault();
            
            console.log('ğŸ” Login attempt initiated...');
            
            const usernameEl = document.getElementById('adminUsername');
            const passwordEl = document.getElementById('adminPassword');
            const loginButton = document.getElementById('loginButton');
            const loginError = document.getElementById('loginError');
            
            // Validate elements exist
            if (!usernameEl || !passwordEl || !loginButton || !loginError) {
                console.error('âŒ Login form elements missing!');
                alert('Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                return;
            }
            
            const username = usernameEl.value.trim();
            const password = passwordEl.value;
            
            console.log(`ğŸ” Attempting login for username: "${username}"`);
            console.log('ğŸ” Available credentials:', Object.keys(ADMIN_CREDENTIALS));
            
            // Validate input
            if (!username || !password) {
                loginError.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                loginError.classList.remove('hidden');
                return;
            }
            
            // Disable login button
            loginButton.disabled = true;
            loginButton.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            // Hide previous errors
            loginError.classList.add('hidden');
            
            try {
                // Security delay to prevent brute force
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check credentials (case sensitive check)
                console.log(`ğŸ” Checking credentials for: "${username}"`);
                console.log(`ğŸ” Password provided: ${password ? '[PROVIDED]' : '[EMPTY]'}`);
                console.log(`ğŸ” Expected password: ${ADMIN_CREDENTIALS[username] ? '[EXISTS]' : '[NOT FOUND]'}`);
                
                if (ADMIN_CREDENTIALS[username] && ADMIN_CREDENTIALS[username] === password) {
                    // Successful login
                    console.log(`âœ… Login successful for: ${username}`);
                    currentAdminUser = username;
                    
                    // Log security event
                    console.log(`ğŸ” Admin login successful: ${username} at ${new Date().toISOString()}`);
                    
                    // Store secure session
                    const sessionData = {
                        username: username,
                        loginTime: Date.now(),
                        expires: Date.now() + SESSION_DURATION
                    };
                    localStorage.setItem('hitech_admin_session', btoa(JSON.stringify(sessionData)));
                    
                    // Clear form
                    usernameEl.value = '';
                    passwordEl.value = '';
                    
                    // Update UI and show admin panel
                    showAdminPanel(username);
                    
                    // Set session timeout
                    setSessionTimeout();
                    
                } else {
                    // Failed login
                    console.warn(`âŒ Failed admin login attempt: ${username} at ${new Date().toISOString()}`);
                    console.warn(`âŒ Username exists: ${!!ADMIN_CREDENTIALS[username]}`);
                    console.warn(`âŒ Password match: ${ADMIN_CREDENTIALS[username] === password}`);
                    
                    loginError.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                    loginError.classList.remove('hidden');
                    passwordEl.value = '';
                    
                    // Security delay after failed attempt
                    setTimeout(() => {
                        loginButton.disabled = false;
                        loginButton.textContent = 'ğŸ”“ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©';
                    }, 2000);
                    return;
                }
                
            } catch (error) {
                console.error('âŒ Login error:', error);
                loginError.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                loginError.classList.remove('hidden');
            }
            
            loginButton.disabled = false;
            loginButton.textContent = 'ğŸ”“ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©';
        }

        // Show admin panel after successful login
        function showAdminPanel(username) {
            console.log(`ğŸ¯ Showing admin panel for: ${username}`);
            
            const adminUser = document.getElementById('adminUser');
            const adminLogin = document.getElementById('adminLogin');
            const adminPanel = document.getElementById('adminPanel');
            
            if (!adminUser || !adminLogin || !adminPanel) {
                console.error('âŒ Admin panel elements missing!');
                alert('Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                return;
            }
            
            // Update username display
            adminUser.textContent = username;
            
            // Hide login screen
            adminLogin.style.display = 'none';
            adminLogin.style.visibility = 'hidden';
            
            // Show admin panel
            adminPanel.classList.add('active');
            adminPanel.style.display = 'block';
            adminPanel.style.visibility = 'visible';
            
            console.log('âœ… Admin panel displayed successfully');
            
            // Debug panel visibility
            console.log('ğŸ” Admin panel element:', adminPanel);
            console.log('ğŸ” Admin panel display:', window.getComputedStyle(adminPanel).display);
            console.log('ğŸ” Admin panel visibility:', window.getComputedStyle(adminPanel).visibility);
            console.log('ğŸ” Admin panel classes:', adminPanel.className);
            
            // Initialize admin features
            setTimeout(() => {
                initAdminFeatures();
            }, 100);
        }

        // Admin logout function
        function adminLogout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŸ')) {
                console.log(`ğŸšª Admin logout: ${currentAdminUser} at ${new Date().toISOString()}`);
                
                // Clear session
                currentAdminUser = null;
                localStorage.removeItem('hitech_admin_session');
                localStorage.removeItem('mikrotik_password'); // Clear for security
                
                if (sessionTimeout) {
                    clearTimeout(sessionTimeout);
                    sessionTimeout = null;
                }
                
                // Reset UI
                const adminLogin = document.getElementById('adminLogin');
                const adminPanel = document.getElementById('adminPanel');
                
                adminLogin.style.display = 'flex';
                adminLogin.style.visibility = 'visible';
                adminPanel.classList.remove('active');
                adminPanel.style.display = 'none';
                adminPanel.style.visibility = 'hidden';
                
                // Clear form
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                document.getElementById('loginError').classList.add('hidden');
                
                updateMikroTikStatus('ØºÙŠØ± Ù…ØªØµÙ„');
            }
        }

        // Check existing session on page load
        function checkExistingSession() {
            const sessionData = localStorage.getItem('hitech_admin_session');
            if (!sessionData) return false;
            
            try {
                const session = JSON.parse(atob(sessionData));
                
                // Check if session is expired
                if (Date.now() > session.expires) {
                    localStorage.removeItem('hitech_admin_session');
                    return false;
                }
                
                // Valid session found
                currentAdminUser = session.username;
                showAdminPanel(session.username);
                
                console.log(`ğŸ”„ Restored admin session: ${session.username}`);
                
                // Set remaining session timeout
                const remainingTime = session.expires - Date.now();
                setSessionTimeout(remainingTime);
                
                return true;
                
            } catch (error) {
                console.error('Invalid session data:', error);
                localStorage.removeItem('hitech_admin_session');
                return false;
            }
        }

        // Set session timeout
        function setSessionTimeout(duration = SESSION_DURATION) {
            if (sessionTimeout) clearTimeout(sessionTimeout);
            
            sessionTimeout = setTimeout(() => {
                alert('Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (30 Ø¯Ù‚ÙŠÙ‚Ø©). ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                adminLogout();
            }, duration);
        }

        // Security function to check authentication
        function requireAuth() {
            if (!currentAdminUser) {
                console.warn('ğŸš¨ Unauthorized access attempt blocked');
                alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ©');
                window.location.reload(); // Force reload to show login
                return false;
            }
            return true;
        }

        // Security monitoring
        document.addEventListener('visibilitychange', function() {
            if (currentAdminUser && document.hidden) {
                console.log('ğŸ”’ Admin page hidden - security monitor active');
            }
        });

        // Prevent right-click on login screen for security
        document.addEventListener('DOMContentLoaded', function() {
            const loginScreen = document.getElementById('adminLogin');
            if (loginScreen) {
                loginScreen.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
            }
        });

        // Security console logging
        console.log('%cğŸ” Hi-Tech Admin Panel - Authorized Access Only', 'color: #22C55E; font-size: 16px; font-weight: bold;');
        console.log('%câš ï¸ All admin activities are monitored and logged', 'color: #EF4444; font-size: 12px;');

        // Setup notification type selection
        function setupNotificationTypes() {
            const types = document.querySelectorAll('.notification-type');
            
            types.forEach(type => {
                type.addEventListener('click', () => {
                    // Remove selected class from all
                    types.forEach(t => t.classList.remove('selected'));
                    
                    // Add selected class to clicked
                    type.classList.add('selected');
                    
                    // Update selected type
                    selectedNotificationType = type.dataset.type;
                    
                    // Update preview
                    updatePreview();
                });
            });
            
            // Select first type by default
            types[0].classList.add('selected');
        }

        // Setup form input handlers
        function setupFormHandlers() {
            const titleInput = document.getElementById('notificationTitle');
            const messageInput = document.getElementById('notificationMessage');
            
            titleInput.addEventListener('input', updatePreview);
            messageInput.addEventListener('input', updatePreview);
        }

        // Update notification preview
        function updatePreview() {
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            
            const previewTitle = document.getElementById('previewTitle');
            const previewBody = document.getElementById('previewBody');
            const previewIcon = document.querySelector('.preview-icon');
            
            // Update icon based on type
            const icons = {
                'maintenance_alert': 'ğŸ”§',
                'maintenance_completed': 'âœ…',
                'service_announcement': 'ğŸ“¢'
            };
            previewIcon.textContent = icons[selectedNotificationType] || 'ğŸ”§';
            
            // Update title
            if (title) {
                previewTitle.textContent = title;
            } else {
                const defaultTitles = {
                    'maintenance_alert': 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø¸Ø§Ù…',
                    'maintenance_completed': 'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù†Ø©',
                    'service_announcement': 'Ø¥Ø¹Ù„Ø§Ù† Ù…Ù‡Ù…'
                };
                previewTitle.textContent = defaultTitles[selectedNotificationType] || 'Ø¥Ø´Ø¹Ø§Ø±';
            }
            
            // Update body
            previewBody.textContent = message || 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡Ø§ Ù‡Ù†Ø§';
        }

        // Send notification to all users (requires authentication)
        async function sendNotification() {
            if (!requireAuth()) return;
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            const duration = document.getElementById('duration').value;
            const priority = document.getElementById('priority').value;
            
            if (!message.trim()) {
                showMessage('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'error');
                return;
            }
            
            try {
                console.log('ğŸ“¤ Broadcasting notification to all users...', {
                    type: selectedNotificationType,
                    title,
                    message,
                    duration,
                    priority
                });
                
                // Disable send button
                const sendButton = document.querySelector('.send-button');
                sendButton.disabled = true;
                sendButton.textContent = 'ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø« Ù„Ù„Ø¬Ù…ÙŠØ¹...';
                
                // Create notification data with proper time handling
                const now = new Date();
                const durationMinutes = parseInt(duration) || 5; // Default to 5 minutes if invalid
                const notificationData = {
                    notificationType: selectedNotificationType,
                    title: title || getDefaultTitle(selectedNotificationType),
                    message: message,
                    duration: durationMinutes * 60 * 1000, // Convert minutes to milliseconds
                    displayDuration: durationMinutes, // Keep original minutes for display
                    priority: priority,
                    timestamp: now.getTime(),
                    timeString: formatArabicTime(now),
                    sender: 'admin',
                    id: 'notification_' + now.getTime() + '_' + Math.random().toString(36).substr(2, 9)
                };
                
                console.log('ğŸ”” Notification data:', {
                    durationInput: duration,
                    durationMinutes: durationMinutes,
                    durationMs: notificationData.duration,
                    displayDuration: notificationData.displayDuration
                });
                
                // Send single notification - use ONLY one method to prevent duplicates
                console.log('ğŸ“¤ Admin: Sending notification via single channel');
                
                // Always use localStorage broadcast (most reliable across all pages)
                localStorage.setItem('hitech_broadcast_notification', JSON.stringify(notificationData));
                
                // Small delay to prevent conflict with localStorage event
                setTimeout(() => {
                    // Trigger for current tab (admin page)
                    window.dispatchEvent(new CustomEvent('hitech-notification', {
                        detail: notificationData
                    }));
                    console.log('ğŸ“¤ Notification broadcasted via localStorage and custom event');
                }, 50);
                
                // Store for new users who visit later with proper timing
                const serverNotifications = JSON.parse(localStorage.getItem('server_notifications') || '[]');
                
                // Add expiration time to stored notifications
                const notificationWithExpiry = {
                    ...notificationData,
                    expiresAt: notificationData.timestamp + notificationData.duration,
                    createdAt: notificationData.timestamp
                };
                
                serverNotifications.push(notificationWithExpiry);
                
                // Remove expired notifications and keep only last 10 active ones
                const currentTime = Date.now();
                const activeNotifications = serverNotifications.filter(notif => notif.expiresAt > currentTime);
                const recentNotifications = activeNotifications.slice(-10);
                
                localStorage.setItem('server_notifications', JSON.stringify(recentNotifications));
                
                // Send to notification server for real cross-device broadcasting (SSE)
                await sendToNotificationServer(notificationData);
                
                // Also send as background push notification (works when pages closed)
                await sendBackgroundPushNotification(notificationData);
                
                // Send to actual users via MikroTik (if configured)
                await broadcastToMikroTikUsers(notificationData);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                showMessage(`ØªÙ… Ø¨Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ${notificationData.timeString} ğŸ‰<br>Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶: ${notificationData.displayDuration} Ø¯Ù‚ÙŠÙ‚Ø©`, 'success');
                
                // Clear form
                document.getElementById('notificationTitle').value = '';
                document.getElementById('notificationMessage').value = '';
                updatePreview();
                
                // Update statistics
                updateNotificationStats();
                
            } catch (error) {
                console.error('âŒ Error broadcasting notification:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            } finally {
                // Re-enable send button
                const sendButton = document.querySelector('.send-button');
                sendButton.disabled = false;
                sendButton.textContent = 'ğŸ“¤ Ø¨Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø²ÙˆØ§Ø±';
            }
        }

        // Broadcast to MikroTik users (for authenticated hotspot users)
        async function broadcastToMikroTikUsers(notificationData) {
            try {
                console.log('ğŸ“¡ Broadcasting to MikroTik users...');
                
                // In a real implementation, this would:
                // 1. Get list of active hotspot users from MikroTik
                // 2. Send notification via MikroTik's web interface or API
                // 3. Or redirect users to a notification page
                
                // For demonstration, we'll simulate this
                const connectedUsers = document.getElementById('connectedUsers').textContent;
                const userCount = parseInt(connectedUsers) || 0;
                
                if (userCount > 0) {
                    console.log(`ğŸ“¨ Simulating broadcast to ${userCount} connected users`);
                    
                    // In production, implement actual MikroTik integration here:
                    // - Use MikroTik REST API to get user list
                    // - Send notifications via hotspot login page redirect
                    // - Or integrate with MikroTik's captive portal
                }
                
            } catch (error) {
                console.error('âŒ Error broadcasting to MikroTik users:', error);
            }
        }

        // Send notification to server for real cross-device broadcasting
        async function sendToNotificationServer(notificationData) {
            const possibleUrls = [
                'http://10.10.10.196:3000/api/notifications/send', // Network IP for mobile devices
                'http://localhost:3000/api/notifications/send',
                'http://127.0.0.1:3000/api/notifications/send',
                'http://2.2.2.2:3000/api/notifications/send',
                'http://192.168.5.1:3000/api/notifications/send', // Hotspot IP
                'http://192.168.137.1:3000/api/notifications/send' // Alternative hotspot IP
            ];
            
            const payload = {
                token: 'hitech_admin_2025', // Admin token
                notificationType: notificationData.notificationType,
                title: notificationData.title,
                message: notificationData.message,
                duration: notificationData.duration,
                displayDuration: notificationData.displayDuration,
                priority: notificationData.priority
            };
            
            let success = false;
            
            for (const url of possibleUrls) {
                try {
                    console.log(`ğŸŒ Attempting to send to server: ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log(`âœ… Server notification sent successfully:`, result);
                        showMessage(`ğŸ“¡ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø®Ø§Ø¯Ù…: ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ${result.clientsNotified || 0} Ø¬Ù‡Ø§Ø² Ù…ØªØµÙ„`, 'success');
                        success = true;
                        break;
                    } else {
                        console.warn(`âš ï¸ Server returned error: ${response.status}`);
                    }
                    
                } catch (error) {
                    console.warn(`âŒ Failed to send to ${url}:`, error.message);
                }
            }
            
            if (!success) {
                console.warn('âš ï¸ Could not connect to notification server - using fallback localStorage method only');
                showMessage('âš ï¸ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„ - Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·', 'warning');
            }
        }
        
        // Send background push notification (works when pages are closed)
        async function sendBackgroundPushNotification(notificationData) {
            const possibleUrls = [
                'http://10.10.10.196:3000/api/push/send',
                'http://localhost:3000/api/push/send',
                'http://127.0.0.1:3000/api/push/send',
                'http://2.2.2.2:3000/api/push/send',
                'http://192.168.5.1:3000/api/push/send',
                'http://192.168.137.1:3000/api/push/send'
            ];
            
            const payload = {
                token: 'hitech_admin_2025',
                notificationType: notificationData.notificationType,
                title: notificationData.title,
                message: notificationData.message,
                priority: notificationData.priority
            };
            
            let success = false;
            
            for (const url of possibleUrls) {
                try {
                    console.log(`ğŸ“± Attempting to send background push to: ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log(`âœ… Background push sent successfully:`, result);
                        showMessage(`ğŸ“± Ø¥Ø´Ø¹Ø§Ø± Ø®Ù„ÙÙŠ: ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø®Ù„ÙÙŠØ© Ø¥Ù„Ù‰ ${result.clientsNotified || 0} Ø¬Ù‡Ø§Ø² (ØªØ¹Ù…Ù„ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø§Øª Ù…ØºÙ„Ù‚Ø©!)`, 'success');
                        success = true;
                        break;
                    } else {
                        console.warn(`âš ï¸ Push server returned error: ${response.status}`);
                    }
                    
                } catch (error) {
                    console.warn(`âŒ Failed to send push to ${url}:`, error.message);
                }
            }
            
            if (!success) {
                console.warn('âš ï¸ Could not connect to push notification server');
                showMessage('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø®Ù„ÙÙŠØ© - ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…', 'warning');
            }
        }

        // Send test notification (single notification only)
        function sendTestNotification() {
            if (!requireAuth()) return;
            
            // Prevent multiple rapid clicks
            const testButton = document.querySelector('.test-button');
            if (testButton.disabled) return;
            
            testButton.disabled = true;
            testButton.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            setTimeout(() => {
                testButton.disabled = false;
                testButton.textContent = 'ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ';
            }, 3000);
            
            // Try Service Worker first (single notification)
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'TRIGGER_NOTIFICATION',
                    notificationType: 'service_announcement',
                    title: 'Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    message: 'Ù‡Ø°Ø§ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.',
                    tag: 'admin-test-' + Date.now() // Unique tag to prevent grouping
                });
                
                showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¹Ø¨Ø± Service Worker!', 'success');
            } 
            // Fallback to direct notification API
            else if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ', {
                        body: 'Ù‡Ø°Ø§ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.',
                        icon: '/icons/icon-192x192.png',
                        tag: 'admin-test-' + Date.now() // Unique tag to prevent duplicates
                    });
                    showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©!', 'success');
                } else if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ', {
                                body: 'Ù‡Ø°Ø§ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.',
                                icon: '/icons/icon-192x192.png',
                                tag: 'admin-test-' + Date.now()
                            });
                            showMessage('ØªÙ… Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±!', 'success');
                        } else {
                            showMessage('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'error');
                        }
                    });
                } else {
                    showMessage('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
                }
            } else {
                showMessage('Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­', 'error');
            }
        }

        // Enhanced notification system with better visibility and control
        function showMessage(text, type, duration = 10000) {
            const messageArea = document.getElementById('message-area');
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            
            // Create message structure with close button and progress bar
            messageDiv.innerHTML = `
                <div class="message-text">${text}</div>
                <button class="message-close-btn" onclick="closeMessage(this)" title="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
                <div class="message-progress"></div>
            `;
            
            // Add to message area (allow multiple notifications)
            messageArea.appendChild(messageDiv);
            
            // Auto-remove after specified duration (default 10 seconds)
            const timeoutId = setTimeout(() => {
                closeMessage(messageDiv.querySelector('.message-close-btn'));
            }, duration);
            
            // Store timeout ID for manual close
            messageDiv.dataset.timeoutId = timeoutId;
            
            // Add click-to-close functionality to entire message
            messageDiv.addEventListener('click', (e) => {
                if (e.target.classList.contains('message-close-btn')) return;
                closeMessage(messageDiv.querySelector('.message-close-btn'));
            });
            
            // Limit to maximum 3 notifications
            const messages = messageArea.children;
            while (messages.length > 3) {
                closeMessage(messages[0].querySelector('.message-close-btn'));
            }
        }

        // Close message with smooth animation
        function closeMessage(closeBtn) {
            if (!closeBtn) return;
            
            const messageDiv = closeBtn.closest('.success-message, .error-message');
            if (!messageDiv) return;
            
            // Clear timeout if exists
            const timeoutId = messageDiv.dataset.timeoutId;
            if (timeoutId) {
                clearTimeout(parseInt(timeoutId));
            }
            
            // Animate out
            messageDiv.style.animation = 'slideOutRight 0.3s ease-in forwards';
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 300);
        }

        // MikroTik API Configuration
        const MIKROTIK_CONFIG = {
            // Configure these settings for your MikroTik router
            host: window.location.hostname || '192.168.88.1', // Router IP
            port: '80', // HTTP port
            username: 'admin', // Admin username
            password: '', // Will be prompted or configured
            protocol: 'http' // Use 'https' if SSL is enabled
        };

        // Load real system status from MikroTik
        async function loadSystemStatus() {
            try {
                console.log('ğŸ”„ Loading real data from MikroTik...');
                
                // Show loading state
                setLoadingState(true);
                
                // Fetch real data from MikroTik API
                const [usersData, systemData, interfaceStats] = await Promise.all([
                    fetchMikroTikUsers(),
                    fetchMikroTikSystemInfo(),
                    fetchMikroTikInterfaceStats()
                ]);
                
                // Update UI with real data
                updateSystemStats(usersData, systemData, interfaceStats);
                
                // Load real connected users
                loadConnectedUsers(usersData);
                
                console.log('âœ… Real data loaded successfully');
                
            } catch (error) {
                console.error('âŒ Error loading MikroTik data:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©.', 'error');
                
                // Fallback to show empty state
                setEmptyState();
            }
        }

        // Fetch connected users from MikroTik Hotspot
        async function fetchMikroTikUsers() {
            const endpoint = '/rest/ip/hotspot/active';
            return await makeMikroTikRequest(endpoint);
        }

        // Fetch system information from MikroTik
        async function fetchMikroTikSystemInfo() {
            const endpoint = '/rest/system/resource';
            return await makeMikroTikRequest(endpoint);
        }

        // Fetch interface statistics from MikroTik
        async function fetchMikroTikInterfaceStats() {
            const endpoint = '/rest/interface';
            return await makeMikroTikRequest(endpoint);
        }

        // Make authenticated request to MikroTik REST API
        async function makeMikroTikRequest(endpoint) {
            const url = `${MIKROTIK_CONFIG.protocol}://${MIKROTIK_CONFIG.host}:${MIKROTIK_CONFIG.port}${endpoint}`;
            
            const credentials = btoa(`${MIKROTIK_CONFIG.username}:${MIKROTIK_CONFIG.password}`);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Basic ${credentials}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                mode: 'cors',
                cache: 'no-cache'
            });
            
            if (!response.ok) {
                throw new Error(`MikroTik API Error: ${response.status} - ${response.statusText}`);
            }
            
            return await response.json();
        }

        // Update system statistics with real data
        function updateSystemStats(usersData, systemData, interfaceStats) {
            // Connected users count
            const connectedUsers = usersData ? usersData.length : 0;
            document.getElementById('connectedUsers').textContent = connectedUsers;
            
            // Calculate total data usage from interface stats
            let totalRx = 0, totalTx = 0;
            if (interfaceStats && Array.isArray(interfaceStats)) {
                interfaceStats.forEach(iface => {
                    if (iface['rx-byte']) totalRx += parseInt(iface['rx-byte']) || 0;
                    if (iface['tx-byte']) totalTx += parseInt(iface['tx-byte']) || 0;
                });
            }
            const totalDataGB = ((totalRx + totalTx) / (1024 * 1024 * 1024)).toFixed(1);
            document.getElementById('dataUsage').textContent = `${totalDataGB} Ø¬ÙŠØ¬Ø§`;
            
            // System information
            if (systemData) {
                const cpuLoad = systemData['cpu-load'] || 0;
                const freeMemory = systemData['free-memory'] || 0;
                const totalMemory = systemData['total-memory'] || 1;
                const memoryUsage = (((totalMemory - freeMemory) / totalMemory) * 100).toFixed(1);
                
                // Update additional stats if available
                document.getElementById('avgSpeed').textContent = `CPU: ${cpuLoad}% | RAM: ${memoryUsage}%`;
            }
            
            // Get today's user count from localStorage or backend
            const todayCount = getTodayUserCount();
            document.getElementById('totalUsersToday').textContent = todayCount;
            
            // Notification stats from localStorage
            const notificationsSent = localStorage.getItem('notificationsSent') || '0';
            const lastNotification = localStorage.getItem('lastNotification') || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
            document.getElementById('notificationsSent').textContent = notificationsSent;
            document.getElementById('lastNotification').textContent = lastNotification;
        }
        
        // Load real connected users from MikroTik data
        function loadConnectedUsers(mikrotikUsersData) {
            const usersList = document.getElementById('usersList');
            
            if (!mikrotikUsersData || mikrotikUsersData.length === 0) {
                usersList.innerHTML = '<div style="text-align: center; opacity: 0.7; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                return;
            }
            
            let usersHTML = '<div class="users-grid">';
            
            mikrotikUsersData.forEach(user => {
                const userInfo = processMikroTikUser(user);
                usersHTML += `
                    <div class="user-item">
                        <div class="user-info">
                            <div class="user-avatar">${userInfo.avatar}</div>
                            <div class="user-details">
                                <div class="user-name">${userInfo.name}</div>
                                <div class="user-ip">${userInfo.ip}</div>
                            </div>
                        </div>
                        <div class="user-stats">
                            <div class="user-time">${userInfo.connectionTime}</div>
                            <div class="user-data">${userInfo.dataUsed}</div>
                        </div>
                    </div>
                `;
            });
            
            usersHTML += '</div>';
            usersList.innerHTML = usersHTML;
        }

        // Process real MikroTik user data
        function processMikroTikUser(mikrotikUser) {
            // Extract real data from MikroTik hotspot active user
            const username = mikrotikUser.user || mikrotikUser.username || 'Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const address = mikrotikUser.address || mikrotikUser['address'] || '0.0.0.0';
            const macAddress = mikrotikUser['mac-address'] || '';
            const uptime = mikrotikUser.uptime || '0s';
            const bytesIn = parseInt(mikrotikUser['bytes-in']) || 0;
            const bytesOut = parseInt(mikrotikUser['bytes-out']) || 0;
            const sessionTime = mikrotikUser['session-time'] || '0s';
            const server = mikrotikUser.server || 'hotspot1';
            
            // Calculate total data usage
            const totalBytes = bytesIn + bytesOut;
            const dataUsed = formatBytesToArabic(totalBytes);
            
            // Format connection time from MikroTik uptime
            const connectionTime = formatMikroTikTime(uptime);
            
            // Determine device icon based on MAC address or other criteria
            const avatar = getDeviceIcon(macAddress, username);
            
            return {
                name: username,
                ip: address,
                avatar: avatar,
                connectionTime: connectionTime,
                dataUsed: dataUsed,
                macAddress: macAddress,
                server: server,
                rawData: mikrotikUser // Keep raw data for advanced operations
            };
        }

        // Convert bytes to Arabic formatted data usage
        function formatBytesToArabic(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
            
            const units = ['Ø¨Ø§ÙŠØª', 'ÙƒÙŠÙ„Ùˆ', 'Ù…ÙŠØ¬Ø§', 'Ø¬ÙŠØ¬Ø§', 'ØªÙŠØ±Ø§'];
            const k = 1024;
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            const value = (bytes / Math.pow(k, i)).toFixed(1);
            
            return `${value} ${units[i]}`;
        }

        // Format MikroTik time format to Arabic
        function formatMikroTikTime(timeStr) {
            // MikroTik time format examples: "1h2m30s", "45m12s", "2d3h15m"
            if (!timeStr || timeStr === '0s') return '0 Ø«Ø§Ù†ÙŠØ©';
            
            const timeRegex = /(?:(\d+)d)?(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/;
            const match = timeStr.match(timeRegex);
            
            if (!match) return timeStr;
            
            const days = parseInt(match[1]) || 0;
            const hours = parseInt(match[2]) || 0;
            const minutes = parseInt(match[3]) || 0;
            const seconds = parseInt(match[4]) || 0;
            
            let result = [];
            
            if (days > 0) result.push(`${days} ÙŠÙˆÙ…`);
            if (hours > 0) result.push(`${hours} Ø³Ø§Ø¹Ø©`);
            if (minutes > 0) result.push(`${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`);
            if (seconds > 0 && result.length === 0) result.push(`${seconds} Ø«Ø§Ù†ÙŠØ©`);
            
            return result.slice(0, 2).join(' ') || '0 Ø«Ø§Ù†ÙŠØ©';
        }

        // Get device icon based on MAC address vendor or username pattern
        function getDeviceIcon(macAddress, username) {
            // Simple device detection based on MAC address OUI or username patterns
            const mac = macAddress.toLowerCase();
            
            // Common device MAC prefixes
            if (mac.startsWith('00:1b:63') || mac.startsWith('00:26:bb')) return 'ğŸ“±'; // Apple
            if (mac.startsWith('00:15:5d') || mac.startsWith('00:03:ff')) return 'ğŸ’»'; // Microsoft/PC
            if (mac.startsWith('00:11:24') || mac.startsWith('00:1e:c9')) return 'ğŸ“²'; // Android
            if (mac.startsWith('00:0f:66') || mac.startsWith('00:1c:b3')) return 'ğŸ“º'; // Smart TV
            
            // Fallback based on username patterns
            if (username.includes('mobile') || username.includes('phone')) return 'ğŸ“±';
            if (username.includes('laptop') || username.includes('pc')) return 'ğŸ’»';
            if (username.includes('tablet') || username.includes('ipad')) return 'ğŸ“²';
            
            // Default device icon
            return 'ğŸ–¥ï¸';
        }
        
        // Helper functions for real data
        function setLoadingState(isLoading) {
            const elements = ['connectedUsers', 'totalUsersToday', 'dataUsage', 'avgSpeed', 'notificationsSent', 'lastNotification'];
            elements.forEach(id => {
                document.getElementById(id).textContent = isLoading ? '...' : '--';
            });
            
            if (isLoading) {
                document.getElementById('usersList').innerHTML = '<div style="text-align: center; opacity: 0.7; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</div>';
            }
        }

        function setEmptyState() {
            document.getElementById('connectedUsers').textContent = '0';
            document.getElementById('totalUsersToday').textContent = '--';
            document.getElementById('dataUsage').textContent = '--';
            document.getElementById('avgSpeed').textContent = '--';
            document.getElementById('usersList').innerHTML = '<div style="text-align: center; opacity: 0.7; padding: 20px;">ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>';
        }

        function getTodayUserCount() {
            // This should come from MikroTik logs or database
            // For now, get from localStorage or estimate
            const today = new Date().toDateString();
            const storedData = localStorage.getItem(`userCount_${today}`);
            return storedData || (Math.floor(Math.random() * 50) + 20);
        }

        // Setup MikroTik authentication
        function setupMikroTikAuth() {
            // Check if credentials are stored
            const storedPassword = localStorage.getItem('mikrotik_password');
            if (storedPassword) {
                MIKROTIK_CONFIG.password = storedPassword;
                return true;
            }
            
            // Prompt for password if not stored
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ø®Ø§Ø¯Ù…:', '');
            if (password) {
                MIKROTIK_CONFIG.password = password;
                localStorage.setItem('mikrotik_password', password);
                return true;
            }
            
            return false;
        }

        // Configure MikroTik connection (requires authentication)
        function configureMikroTik() {
            if (!requireAuth()) return;
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ø®Ø§Ø¯Ù…:', '');
            if (password) {
                MIKROTIK_CONFIG.password = password;
                localStorage.setItem('mikrotik_password', password);
                updateMikroTikStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...');
                loadSystemStatus();
            }
        }

        // Update MikroTik connection status
        function updateMikroTikStatus(status) {
            document.getElementById('mikrotikStatus').textContent = status;
        }

        // Initialize admin features (called after login)
        function initAdminFeatures() {
            console.log('ğŸ”§ Admin Features: Initializing...');
            
            // Setup notification type selection
            setupNotificationTypes();
            
            // Setup form handlers
            setupFormHandlers();
            
            // Update preview
            updatePreview();
            
            // Check for active notifications and show status
            checkActiveNotifications();
            
            // Setup MikroTik authentication
            if (setupMikroTikAuth()) {
                // Load real data from MikroTik
                loadSystemStatus();
                
                // Set up auto-refresh every 30 seconds
                setInterval(loadSystemStatus, 30000);
                
                // Check notification status every minute (without showing popup)
                setInterval(() => checkActiveNotifications(false), 60000);
            } else {
                updateMikroTikStatus('ØºÙŠØ± Ù…ØªØµÙ„ - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯');
                setEmptyState();
            }
            
            console.log('âœ… Admin Features: Initialization complete');
        }

        // Check for active notifications and display them
        function checkActiveNotifications(showNotification = true) {
            const serverNotifications = JSON.parse(localStorage.getItem('server_notifications') || '[]');
            const now = Date.now();
            let activeCount = 0;
            let totalRemainingTime = 0;
            
            console.log('ğŸ” Checking active notifications:', serverNotifications.length);
            
            const activeNotifications = serverNotifications.filter(notif => {
                if (notif.expiresAt > now) {
                    activeCount++;
                    const remainingMs = notif.expiresAt - now;
                    const remainingMin = Math.ceil(remainingMs / (1000 * 60));
                    totalRemainingTime += remainingMin;
                    
                    console.log('ğŸ“‹ Active notification:', {
                        title: notif.title,
                        displayDuration: notif.displayDuration,
                        durationMs: notif.duration,
                        createdAt: new Date(notif.createdAt),
                        expiresAt: new Date(notif.expiresAt),
                        remainingMs: remainingMs,
                        remainingMin: remainingMin
                    });
                    
                    return true;
                }
                return false;
            });
            
            // Update the status display
            const activeNotificationsElement = document.getElementById('activeNotifications');
            if (activeNotificationsElement) {
                if (activeCount > 0) {
                    const avgTime = Math.ceil(totalRemainingTime / activeCount);
                    activeNotificationsElement.textContent = `${activeCount} (Ù…ØªÙˆØ³Ø·: ${avgTime} Ø¯Ù‚ÙŠÙ‚Ø©)`;
                    activeNotificationsElement.style.color = '#22C55E';
                } else {
                    activeNotificationsElement.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                    activeNotificationsElement.style.color = '#9CA3AF';
                }
            }
            
            // Show notification only on first load or when explicitly requested
            if (showNotification && activeCount > 0) {
                const lastActive = activeNotifications.sort((a, b) => b.timestamp - a.timestamp)[0];
                
                if (lastActive) {
                    const remainingTime = Math.ceil((lastActive.expiresAt - now) / (1000 * 60));
                    const sentTime = formatArabicTime(new Date(lastActive.timestamp));
                    const originalDuration = lastActive.displayDuration || Math.ceil(lastActive.duration / (1000 * 60));
                    
                    console.log('ğŸ“Š Active notification details:', {
                        activeCount,
                        title: lastActive.title,
                        originalDuration,
                        remainingTime,
                        displayDuration: lastActive.displayDuration,
                        duration: lastActive.duration
                    });
                    
                    showMessage(`ÙŠÙˆØ¬Ø¯ ${activeCount} Ø¥Ø´Ø¹Ø§Ø± Ù†Ø´Ø· ğŸ“¢<br>Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±: "${lastActive.title}"<br>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©: ${originalDuration} Ø¯Ù‚ÙŠÙ‚Ø©<br>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remainingTime} Ø¯Ù‚ÙŠÙ‚Ø©<br>ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${sentTime}`, 'success', 10000);
                }
            }
            
            return { activeCount, activeNotifications };
        }

        // Main initialization (called on page load)
        function initAdminPanel() {
            console.log('ğŸ” Admin Panel: Starting secure initialization...');
            
            try {
                const adminLogin = document.getElementById('adminLogin');
                const adminPanel = document.getElementById('adminPanel');
                
                if (!adminLogin || !adminPanel) {
                    console.error('âŒ Critical admin elements missing!');
                    document.body.innerHTML = '<div style="color: red; text-align: center; padding: 50px; font-size: 18px;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©<br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</div>';
                    return;
                }
                
                // Check for existing session
                if (!checkExistingSession()) {
                    // No valid session, show login screen
                    adminLogin.style.display = 'flex';
                    adminLogin.style.visibility = 'visible';
                    adminPanel.classList.remove('active');
                    adminPanel.style.display = 'none';
                    adminPanel.style.visibility = 'hidden';
                    console.log('ğŸ‘¤ Admin login required');
                } else {
                    // Valid session exists, show admin panel
                    adminLogin.style.display = 'none';
                    adminLogin.style.visibility = 'hidden';
                    adminPanel.classList.add('active');
                    adminPanel.style.display = 'block';
                    adminPanel.style.visibility = 'visible';
                    console.log('âœ… Existing session found, admin panel loaded');
                }
                
            } catch (error) {
                console.error('âŒ Initialization error:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
            }
            
            console.log('âœ… Admin Panel: Secure initialization complete');
        }

        
        // Refresh system data from MikroTik (requires authentication)
        async function refreshSystemData() {
            if (!requireAuth()) return;
            console.log('ğŸ”„ Refreshing data from MikroTik...');
            
            // Show loading state
            setLoadingState(true);
            
            try {
                // Force reload from MikroTik
                await loadSystemStatus();
                showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­! ğŸ”„', 'success');
            } catch (error) {
                console.error('âŒ Error refreshing data:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            }
        }

        // Update notification statistics
        function updateNotificationStats() {
            const current = parseInt(document.getElementById('notificationsSent').textContent) || 0;
            const newCount = current + 1;
            
            // Format current time properly in Arabic
            const now = new Date();
            const timeString = formatArabicTime(now);
            
            // Update UI
            document.getElementById('notificationsSent').textContent = newCount;
            document.getElementById('lastNotification').textContent = timeString;
            
            // Store in localStorage for persistence
            localStorage.setItem('notificationsSent', newCount);
            localStorage.setItem('lastNotification', timeString);
        }

        // Format time in Arabic
        function formatArabicTime(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            // Convert to 12-hour format with Arabic AM/PM
            const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
            const displayHours = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;
            
            return `${displayHours}:${minutes}:${seconds} ${period}`;
        }

        // Helper functions for notifications
        function getDefaultTitle(type) {
            const titles = {
                'maintenance_alert': 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ù†Ø¸Ø§Ù…',
                'maintenance_completed': 'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'service_announcement': 'Ø¥Ø¹Ù„Ø§Ù† Ù…Ù‡Ù…'
            };
            return titles[type] || 'Ø¥Ø´Ø¹Ø§Ø±';
        }

        function getNotificationIcon(type) {
            const icons = {
                'maintenance_alert': 'ğŸ”§',
                'maintenance_completed': 'âœ…',
                'service_announcement': 'ğŸ“¢'
            };
            return icons[type] || 'ğŸ””';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initAdminPanel);
    </script>
</body>
</html>